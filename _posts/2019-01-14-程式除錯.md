---
layout      : post
title       : 程式除錯
date        : 2019-01-14 10:41:10 +0800
categories  : 資料導向程式設計
tags        : [資料架構,程式除錯]
---
## 程式除錯

### 錯誤訊息
- 產生錯誤（ Errors）訊息時，將停止執行所有程式
- 產生警告（ Warnings）訊息會說明潛在的問題，可繼續執行程式
- 訊息（Messages）一般回傳的訊息傳達代碼輸出的結果


### 程式錯誤類型：
- 編譯期間錯誤（ Compiler error）：使用者輸入不符合要求的資料，但程式沒有考慮該情況所產生的錯誤
- 執行期間錯誤（ Runtime error）：表示程式在執行階段所發生的錯誤
- 邏輯錯誤（ Logic error）：程式可以正常執行並且正常輸出，但輸出的結果與預期不一致
- 語法錯誤（ Syntax error）：表示程式撰寫時產生的錯誤


#### 練習題
200 語法錯誤
D 200. Python 語言中， for 迴圈的結尾忘記加上冒號（ :）是屬於哪一種錯誤？
(A) 編譯期間錯誤（ Compiler error）
(B) 執行期間錯誤（ Runtime error）
(C) 邏輯錯誤（ Logic error）
(D) 語法錯誤（ Syntax error）

146程式錯誤
D 146. 關於程式錯誤，下列敘述何者不正確？
(A) 語法錯誤（ Syntax error）表示程式撰寫時產生的錯誤
(B) 執行期間錯誤（ Runtime error）表示程式在執行階段所發生的錯誤
(C) 邏輯錯誤（ Logic error）表示程式可以正常編譯執行，但使用該程式時所產生的錯誤
(D) 使用者輸入不符合要要求的資料，但程式沒有考慮該情況所產生的錯誤稱為執行期間錯誤（ Runtime error）


246錯誤類型
C 246. 請問以下哪個程式錯誤類型是指程式可以正常執行並且正常輸出，但輸出的結果與預期不一致？
(A) 語法錯誤（ Syntax Error）
(B) 執行期間錯誤（ Runtime Error）
(C) 邏輯錯誤（ Logic Error）
(D) 編譯時期的錯誤（ Compile Error）


47程式除錯
B 47. 關於程式除錯， 下列敘述何者不正確？
(A) 程式即便是正常執行，仍有可能隱藏錯誤
(B) 經過完整測試後的程式，就不會有錯誤
(C) 語法錯誤（ Syntactic errors）一般編譯器都會找出來這種錯誤
(D) 語義錯誤（ Semantic errors）是編譯器所無法檢查出來的錯誤

A 42. R 語言中，關於程式碼執行時產生的訊息，下列敘述何者「不正確」？
(A) 產生錯誤（ errors）訊息時，將繼續執行無錯誤的程式
(B) 警告（ warnings）訊息會說明潛在的問題
(C) 一般傳回的訊息在於說明代碼輸出的結果
(D) 產生警告（ warnings）訊息時，可繼續執行程式

94軟體錯誤
A 94. 軟體的錯誤包括：
1.失敗（ Failure）： 一個系統或軟體元件的行為偏離其原先定義好的規格。
2.故障（ Fault）：一個不正確的步驟、方法或電腦程式軟體中導致某些故障發生的潛在條件定義。
3.錯誤（ Error）：人為行為導致不正確的結果。請問以下觀念何者錯誤？
(A) 錯誤都會導致故障
(B) 不是所有的故障都會導致失敗
(C) 錯誤可能會導致失敗
(D) 錯誤可能是源自誤解或不正確的動作

249錯誤類型
C 249. 某專案採用 Python 語言來設計，請問 Python 的變數名稱中，「 10account」是屬於哪一種程式錯誤類型？
(A) 程式邏輯設計錯誤
(B) 程式執行結果錯誤
(C) 程式語法錯誤
(D) 程式判斷流程錯誤

198除錯
D 198. 下列何者是不正確的觀念？
(A) 提高程式的可讀性， 可減少除錯的難度
(B) 使用平行處理技術， 並非一定能增加程式效能
(C) 即使是無法重現的錯誤，仍須記錄起來
(D) 為了減少除錯的難度，盡量不要使用多執行緒


## 程式除錯流程
1. 發現程式錯誤的存在->記錄問題、重視問題
2. 以隔離、消除的方式對錯誤進行定位->定位問題
3. 確定錯誤產生的原因
4. 提出糾正錯誤的解決辦法
5. 對程式錯誤予以改正，重新測試->解決問題

- 可先要求程式碼的邏輯正確，再設法提升執行效率
- 測試程式投入值的邊界狀況（ Edge Cases）是否會發生錯誤

#### 練習題
B 48. 一般而言，程式設計師透過下列程序偵錯與解決代碼的錯誤，下列何者為流程順序？
1. 找出錯誤的原因
2. 讓錯誤可以重製
3. 修正錯誤並測試
4. 意識到錯誤的存在
(B) 4＞2＞1＞3

145除錯流程
D 145. 下列何項除錯流程的順序最為合適？
1. 解決問題
2. 重現問題
3. 記錄問題
4. 定位問題
(D) 3> 2> 4> 1

238除錯流程
B 238. 一般而言，程式設計師透過下列程序偵查與解決代碼的錯誤， 請問流程順序何者正確？
1. 找出錯誤的原因
2. 尋找相似的錯誤並修正之
3. 讓錯誤可以重製
4. 修正錯誤並測試
5. 意識到錯誤的存在
(B) 5>3>1>4>2

45程式除錯
B 45. 程式除錯的過程包括：
1. 以隔離、消除的方式對錯誤進行定位
2. 提出糾正錯誤的解決辦法
3. 發現程式錯誤的存在
4. 對程式錯誤予以改正，重新測試
5.確定錯誤產生的原因
請問依序為何？
(B) 3>1>5>2>4

## 除錯技巧
- 檢查是否有不合法的變數名稱
- 單步執行（ Single-stepping）
- 中斷點（ Breakpoint）： 透過插入中斷點的方式，追蹤程式執行過程中，變數的變化，以利找出邏輯中可能的錯誤
- 追蹤某些變數：所有的變數都清楚命名，以便追蹤，將程式執行過程中的變數資訊，透過 Console 印出來
- 程式碼中增加除錯日誌（ Debug Log）
- 在問題點附近加入 Try/Catch 以便鎖定錯誤範圍
- 用 traceback 函數獲得錯誤訊息的額外資訊
- 撰寫兩個版本的程式以確認結果正確無誤
- 測試程式投入值的邊界狀況（ Edge Cases）是否會發生錯誤
- 撰寫程式時讓錯誤可以重製，可便於偵查
- 可先要求程式碼的邏輯正確，再設法提升執行效率
- 可藉由函數輔助處理例外狀況與瞭解錯誤訊息
- 除錯前要先備份（或透過版本控制工具），以免程式修正後產生其他副作用時能順利回復
- 一次只修改一處可能出錯的地方，每次修改後執行看看是否正確
- 避免所有程式片段都寫完後才進行除錯

### 錯誤的除錯技巧
- 重新執行程式數回，直到程式可以執行為止
- 將所有的 for 迴圈換成 while 迴圈
- 將程式碼由多行合併為一行程式碼
- 儘量以一個函數完成所有的事
- 可執行的程式即為無誤的程式(可能為邏輯錯誤)

#### 練習題
95除錯
C 95. 下列何者不是典型除錯工具通常具備的功能？
(A) 單步執行（ Single-stepping）
(B) 中斷點（ Breakpoint）
(C) 缺陷跟蹤管理
(D) 追蹤某些變數

97除錯
C 97. 下列何者不是常用的除錯技巧？
(A) 插入中斷點，觀察變數值
(B) 程式碼中增加除錯日誌（ Debug Log）
(C) 重新執行程式數回，直到程式可以執行為止
(D) 在問題點附近加入 Try/Catch 以便鎖定錯誤範圍

143除錯
C 143. 下列何者無利於除錯進行？
(A) 所有的變數都清楚命名，以便追蹤
(B) 將程式執行過程中的變數資訊，透過 Console 印出來
(C) 將所有的 for 迴圈換成 while 迴圈
(D) 透過插入中斷點的方式，追蹤程式執行過程中，變數的變化，以利找出邏輯中可能的錯誤

150除錯常用方法
D 150. 下列何者不是程式除錯的常用方法？
(A) 設定中斷點
(B) 使用不同變數值
(C) 檢查是否有不合法的變數名稱
(D) 將程式碼由多行合併為一行程式碼

196除錯技巧
C 196. 下列何項不是程式偵錯常用的技巧？
(A) 用 traceback 函數獲得錯誤訊息的額外資訊
(B) 撰寫兩個版本的程式以確認結果正確無誤
(C) 儘量以一個函數完成所有的事
(D) 測試程式投入值的邊界狀況（ Edge Cases）是否會發生錯誤

237除錯
B 237. 關於程式碼錯誤處理，下列敘述何者不正確？
(A) 撰寫程式時讓錯誤可以重製，可便於偵查
(B) 可執行的程式即為無誤的程式
(C) 可先要求程式碼的邏輯正確，再設法提升執行效率
(D) 可藉由函數輔助處理例外狀況與瞭解錯誤訊息

D 43. 關於除錯的技巧， 下列敘述何者較「不適當」 ？
(A) 除錯前要先備份（或透過版本控制工具），以免程式修正後產生其他副作用時能順利回復
(B) 一次只修改一處可能出錯的地方，每次修改後執行看看是否正確
(C) 避免所有程式片段都寫完後才進行除錯
(D) 有修正過的程式，可以標記起來，以後不可能在此處發生錯誤

C 45. 下列何種行為有利於程式除錯？
(A) 每次都在不同環境下執行程式
(B) 更改變數名稱
(C) 控制錯誤變因
(D) 加入無窮迴圈

### 可能錯誤狀況與錯誤

194除錯
C 194. 在直譯式程式執行過程中， 發生卡住不動且無錯誤訊息的情形，下列何者為可能發生的原因？
(A) 註解寫太多，造成系統無法執行
(B) 因語法錯誤造成
(C) 程式中出現無窮迴圈的狀態
(D) 缺少 catch 處理

B 96. 使用多執行緒時，很容易造成死結，請問造成死結的原因為何？
(A) 系統不支援
(B) 多個執行緒試圖掌握相同資源
(C) 網路中斷
(D) 執行緒不相容


### 減少錯誤機會
- 良好的測試案例
- 清晰的程式碼註解
- 盡少使用程式語言提供的語法糖（ Syntactic sugar）
- 程式碼交由其他工程師進行代碼審查（ Code Review）

撰寫程式注意要點：
- 輸入輸出的符號大多是資料物件，可能是一維、二維或更高維，故多採用向量化資料運算方式，可避免額外迴圈執行，以提升效能。
- 許多運算子及函數都是向量化的處理函數，也就是說是隱藏著迴圈的處理方式。
- 資料操弄時多採用邏輯值引索，避免使用if...then...條件式語法
- 留意何時短物件中的元素被循環利用
- 留意元素型別可能被強制轉換的狀況
- 留意引用函數可能預設的引數值與可能的引數選項
- 留意輸入的資料物件經函數處理後產生的輸出物件其維度、資料結構、類別型態是否改變
- 善用自定義函數模組化工作流程
- 精進記憶體管理與撰寫平行化程式的技巧，以提升執行效率

參考閱讀：大數據分析與應用實戰：統計機器學習之資料導向程式設計



#### 練習題

48減少出錯的機率
C 48. 下列何者無法減少程式出錯的機率？
(A) 良好的測試案例
(B) 清晰的程式碼註解
(C) 盡可能使用程式語言提供的語法糖（ Syntactic sugar）
(D) 程式碼交由其他工程師進行代碼審查（ Code Review）

## Python除錯方法

### Try-catch架構
- try：需要被監控是否會出錯的程式區塊
- except：出了哪種錯誤，要有怎樣相對應的處理
- else：都沒錯誤，就會執行此區塊的程式
- finally：不論如何都會執行此區塊的程式

強制產生錯誤並中斷 raise & assert
- raise 錯誤類型(“錯誤訊息”)
- assert 類似 if 及 raise 的簡化版本

### 除錯模組
 pdb 模組：
- q(quit)：離開
- p [some variable](print)：秀某個變數的值
- n(next line)：下一行
- c(continue)：繼續下去
- s(step into)：進入函式
- r(return): 到本函式的return敘述式
- l(list)：秀出目前所在行號
- !： 改變變數的值

參考閱讀：<https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/368179/>

#### 練習題
147 try…except
D 147. Python 語言中， try…except 處理例外時，加入哪一個子句（ Clause）可以清除錯誤且一定會執行？
(A) except
(B) else
(C) clean
(D) finally

148 raise
C 148. Python 語言中，哪一個敘述可以由使用者自訂例外？
(A) catch
(B) define
(C) raise
(D) finally

250程式執行try…except
B 250. 請問以下 Python 程式碼執行後其結果為何？
try:
X = 10
Y = 0
Z = X / Y
except ZeroDivisionError:
print("除數不得為 0")
except Exception as e1:
print(e1.args)
else:
print("沒有捕捉到例外！ X 除以 Y 的結果等於 Z ")
finally:
print("離開 try…except 區塊")
(A) 除數不得為 0
(B) 除數不得為 0；離開 try…except
(C) 除數不得為 0；沒有捕捉到例外！ X 除以 Y 的結果等於 Z；離開try…except
(D) 無法執行

247 try…except
C 247. 請問以下敘述執行後輸出的結果為何？
try:
x=0
y.split()
y=0
except:
z=0
print(z)
print(y)
(A) y 與 z 皆可正常輸出
(B) y 與 z 皆會發生錯誤
(C) y 會發生錯誤， z 可正常輸出
(D) y 可正常輸出， z 會發生錯誤

A 7. 關於 Python 之資料結構字典（ dictionary）與例外處理（ exception），執行附圖程式後，下列何者為輸出結果？
d = {"M":1, "A":1, "R":2, "X":1}
for c in "HARPO":
print(d[c] + '-')
(A) KeyError: 'H'
(B) TypeError: list indices must be integers, not str
(C) SyntaxError: invalid syntax
(D) TypeError: unsupported operand type(s) for +: 'int' and 'str'

A 50. Python 語言中， 參考下列程式碼， calc_mean()函數雖可正常執行，但卻並非返回預期之結果（ 三數平均值）。請問此為下列何種類型錯誤？
def calc_mean(a: int, b: int, c: int):
'''計算 a, b, c 三數的平均值, 並返回其值'''
mean = a + b + c / 3
return mean
calc_mean(5, 10, 15) # return 20.0
(A) 邏輯錯誤（ logic error）
(B) 語法錯誤（ syntax error）
(C) 執行期間錯誤（ runtime error）
(D) 編譯時期錯誤（ compile error）

B 46. Python 的 pdb 模組中， 何種函數可進行程式除錯？
(A) debug
(B) run
(C) execute
(D) trace

C 47. 關於 Python 中的 traceback( )函數，下列敘述何者「不正確」 ？
(A) 可以協助獲得錯誤訊息的額外資訊
(B) 會顯示錯誤發生於何處
(C) 會顯示為何發生錯誤
(D) 未顯示錯誤訊息的程式碼，不一定代表結果無誤

## R語言除錯方法

- system.time()：可以衡量程式碼的執行時間
- suppressMessages()：可以控制顯示或關閉訊息顯示

### R語言例外狀況處理函數：
- traceback()：如果程式錯誤並已完全終止，此時立即使用 traceback 將顯示錯誤前的最近執行的語法。
  - 只會顯示錯誤發生於何處，並未告知為何發生錯誤
- debug()： traceback 只能指出錯誤的發生處，並不能幫助使用者找出程式的錯誤。
  - debug 可以逐行執行並提供互動式的除錯功能。
  - undebug 於完成除錯後用來移除 debug 功能
- browser()：在上述 debug() 函數中可以逐行除錯，如果希望在特定程式碼中進行除錯，此時可使用 browser() 函數，將程式暫時中斷並等待使用者輸入。
  - n (next) 繼續執行下一行程式，按下[Enter]鍵亦可。
  - c (continue) 繼續執行後續所有程式並回傳結果。
  - Q (quit) 離開偵測模式。

-  try()、 tryCatch()、withCallingHandlers()：例外狀況處理函數。
-  stop()、warning()、message()：可以幫助回傳訊息，以了解程式碼執行的狀況

參考閱讀 <http://rwepa.blogspot.com/2018/09/rdebug.html>

#### 練習題
D 149. 下列何者不是 R 語言的除錯（ Debug）函數？
(A) debug
(B) browser
(C) traceback
(D) assert

C 44. 關於 traceback( )函數，下列敘述何者「不正確」？
(A) 可以協助獲得錯誤訊息的額外資訊
(B) 會顯示錯誤發生於何處
(C) 會顯示為何發生錯誤
(D) 未顯示錯誤訊息的程式碼，不一定代表結果無誤

A 38. 關於程式除錯與效率監測 R 函數，下列敘述何者「不正確」 ？
(A) debug( )可關閉函數的偵錯模式
(B) suppressMessages( )可用來壓制錯誤訊息
(C) traceback( )可以協助獲得錯誤訊息的額外資訊
(D) system.time( )可以衡量程式碼的執行時間

239執行產生資訊
A239. 在 R 語言中，程式碼執行時會產生訊息，下列敘述何者不正確？
(A) 產生錯誤（ errors）訊息時，將繼續執行無錯誤的程式
(B) 警告（ warnings）訊息會說明潛在的問題
(C) 一般傳回的訊息在於說明代碼輸出的結果
(D) 產生警告（ warnings）訊息時，可繼續執行程式

243例外狀況處理函數
B 243. 「例外狀況處理函數」 之目的為允許程式設計師在例外狀況發生時，採取某些行動， 例如： 結合 stop()函數，以讓程式設計師在必要的時候傳回訊息，瞭解程式碼執行的狀況。下列何者不為 R 語言的例外狀況處理函數？
(A) withCallingHandlers( )
(B) supressMessages( )
(C) tryCatch( )
(D) try( )

244除錯與效率監控函數
A 244. 關於程式除錯與效率監測 R 函數， 下列敘述何者不正確？
(A) debug( )可關閉函數的偵錯模式
(B) suppressMessages( )可用來壓制錯誤訊息
(C) traceback( )可以協助獲得錯誤訊息的額外資訊
(D) system.time( )可以衡量程式碼的執行時間

245除錯與效率監控函數
D 245. 處理 R 語言程式碼的例外狀況、錯誤與訊息時，通常不會使用下列何種函數？
(A) stop( )
(B) warning( )
(C) message( )
(D) system.time( )

C 48. 關於 R 語言 browser( )函數，下列敘述何者「 不正確」 ？
(A) 將一步一步執行程式碼，進入偵錯模式
(B) 偵錯模式中， n 指令可執行下一行
(C) 偵錯模式中， r 指令可關閉偵測模式
(D) 偵錯模式中， c 指令可繼續執行函數直到結束
